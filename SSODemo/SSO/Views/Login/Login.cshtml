
@{
    ViewBag.Title = "Login";
}

<h2>Login</h2>

<div>
    用户名： <input type="text" id="UserName" name="UserName" />
    密码： <input type="password" id="Password" name="Password" />
    <button id="btn_save">登录</button>
</div>


<script>
    $("#btn_save").click(function () {
        var urlstr = getUrlParam("returnurl")
        $.post("@Url.Action("SaveLogin")", { username: $("#UserName").val(), password: $("#Password").val() }, function (res) {
            if (res.Flag) {
                if (!(urlstr == "" || urlstr == undefined || urlstr == null)) {
                    window.location.href = urlstr + "?token=" + res.Data.token;
                } else {
                    window.location.href ="/Home/Index";
                }

            } 
        })
    })

    //获取url中的参数
    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg);  //匹配目标参数
        if (r != null) return unescape(r[2]); return null; //返回参数值
    }
</script>